<!DOCTYPE html>
<html lang="ms">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem E-Stok Digital SKKM</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Outfit', sans-serif; background: #f1f5f9; }
        .bg-navy-pro { background: linear-gradient(135deg, #020617 0%, #0f172a 100%); }
        .border-gold { border-top: 5px solid #fbbf24; }
        .glass-panel { 
            background: rgba(255, 255, 255, 0.98);
            box-shadow: 0 10px 50px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid #e2e8f0;
        }
        .admin-card { @apply flex flex-col items-center p-4 bg-white border border-slate-100 rounded-2xl transition-all hover:border-amber-500 hover:shadow-md; }
    </style>
</head>
<body class="min-h-screen text-slate-800">

    <!-- Header Korporat -->
    <header class="bg-navy-pro text-white py-12 px-6 shadow-2xl relative overflow-hidden text-center md:text-left">
        <div class="max-w-6xl mx-auto flex flex-col md:flex-row items-center justify-between gap-8 relative z-10">
            <div class="flex items-center gap-6">
                <img src="https://i.postimg.cc/fLF8Qqnw/LOGO-SKKM-2023-LATEST.png" class="h-24 drop-shadow-lg" alt="Logo SKKM">
                <div>
                    <h1 class="text-4xl font-black tracking-tighter uppercase leading-none italic text-white">Sistem E-Stok Digital</h1>
                    <p class="text-amber-400 text-sm font-bold tracking-[0.4em] uppercase mt-2 opacity-90 leading-none tracking-tighter">SK Kuala Muput, Tatau</p>
                </div>
            </div>
            
            <div class="flex flex-col items-center md:items-end gap-4">
                <div class="flex bg-white/10 p-1.5 rounded-2xl backdrop-blur-xl border border-white/20 shadow-inner">
                    <button onclick="setRole('guru')" id="btnRoleGuru" class="px-6 py-2 rounded-xl text-[10px] font-black uppercase transition-all bg-amber-500 text-slate-900 shadow-xl">Mod Guru</button>
                    <button onclick="promptAdmin()" id="btnRoleAdmin" class="px-6 py-2 rounded-xl text-[10px] font-black uppercase transition-all text-slate-400 hover:text-white">Mod Admin</button>
                </div>
            </div>
        </div>
    </header>

    <main class="max-w-6xl mx-auto px-4 -mt-12 relative z-20 pb-20">
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-10">
            
            <!-- Bahagian Borang -->
            <div class="lg:col-span-7">
                <div class="glass-panel rounded-[3rem] p-10 border-gold relative overflow-hidden">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-10">
                        <div class="flex items-center gap-4">
                            <div id="roleIcon" class="bg-slate-900 text-white p-3 rounded-2xl shadow-2xl transition-colors duration-500">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>
                            </div>
                            <div>
                                <h2 id="roleTitle" class="text-3xl font-black text-slate-800 uppercase tracking-tighter leading-none">Rekod Pengeluaran</h2>
                                <p id="roleSub" class="text-[10px] font-bold text-slate-400 uppercase tracking-widest mt-1">Sila lengkapkan butiran pengambilan stok</p>
                            </div>
                        </div>
                        <a href="https://docs.google.com/spreadsheets/d/127wv0kjwtQNAFqa1zCeBNp20O1tHC9GVr32h33sml6Q/edit" target="_blank" id="adminSheetBtn" class="hidden flex items-center gap-2 bg-emerald-600 hover:bg-emerald-700 text-white px-5 py-3 rounded-2xl text-[10px] font-black uppercase tracking-widest shadow-lg transition-all active:scale-95">
                            üìä Buka Laporan ‚Üó
                        </a>
                    </div>

                    <form id="stokForm" class="space-y-6">
                        <div class="space-y-2">
                            <label class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] ml-2">Nama Pegawai / Staf</label>
                            <select name="guru" id="staffDropdown" required class="w-full p-5 bg-slate-900 text-white border-none rounded-[1.5rem] font-bold text-sm uppercase shadow-inner outline-none focus:ring-4 focus:ring-amber-500/20 transition-all">
                                <option value="" disabled selected>-- MEMUATKAN SENARAI STAF --</option>
                            </select>
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] ml-2">Punca Kewangan</label>
                                <select name="punca" class="w-full p-5 bg-slate-50 border border-slate-200 rounded-[1.5rem] font-bold text-sm outline-none">
                                    <option>PCG PANITIA</option><option>LPBT</option><option>SUMBANGAN / LAIN-LAIN</option><option>TIDAK PASTI</option>
                                </select>
                            </div>
                            <div class="space-y-2">
                                <label class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] ml-2">Jenis Transaksi</label>
                                <select name="gerakan" id="gerakanField" class="w-full p-5 border-2 border-slate-100 rounded-[1.5rem] font-black text-sm outline-none transition-all"></select>
                            </div>
                        </div>

                        <div class="space-y-2">
                            <label class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] ml-2">Nama Bahan / Item</label>
                            <input type="text" name="item" required placeholder="NAMA BARANG" class="w-full p-5 bg-slate-50 border border-slate-200 rounded-[1.5rem] font-bold text-sm uppercase outline-none focus:bg-white transition-all">
                        </div>

                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div class="space-y-2">
                                <label class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em] ml-2">Kuantiti (Bilangan)</label>
                                <input type="number" name="qty" required placeholder="0" class="w-full p-5 bg-slate-50 border border-slate-200 rounded-[1.5rem] font-black text-xl text-center outline-none">
                            </div>
                            <div class="space-y-2">
                                <div class="flex justify-between items-center px-2">
                                    <label class="text-[11px] font-black text-slate-400 uppercase tracking-[0.2em]">Sebab / Invois</label>
                                    <button type="button" onclick="toggleInv()" id="tBtn" class="text-[9px] font-bold text-amber-600 bg-amber-50 px-3 py-1 rounded-full uppercase">Manual ‚úé</button>
                                </div>
                                <select id="iSel" class="w-full p-5 bg-slate-50 border border-slate-200 rounded-[1.5rem] font-bold text-sm outline-none">
                                    <option value="KEGUNAAN SEMASA">KEGUNAAN SEMASA</option><option value="PASCA BANJIR">PASCA BANJIR</option><option value="STOK LAMA">STOK LAMA</option>
                                </select>
                                <input type="text" id="iInp" placeholder="TAIP NO. INVOIS / SEBAB" class="hidden w-full p-5 bg-white border border-amber-200 rounded-[1.5rem] font-bold text-sm uppercase outline-none">
                            </div>
                        </div>

                        <button type="submit" id="submitBtn" class="w-full bg-amber-500 hover:bg-amber-600 text-slate-900 font-black py-6 rounded-[1.5rem] uppercase tracking-[0.3em] text-xs shadow-2xl active:scale-95 transition-all">üöÄ Simpan Rekod & Inform Admin</button>
                        
                        <!-- Pusat Notifikasi Admin -->
                        <div id="waCenter" class="hidden mt-10 p-8 bg-slate-100 border border-slate-200 rounded-[2.5rem] text-center">
                            <h3 class="text-[10px] font-black text-slate-800 uppercase tracking-[0.2em] mb-6 italic underline decoration-amber-400 decoration-4 underline-offset-8 leading-none">Sila Maklumkan Admin Pejabat (WhatsApp):</h3>
                            
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <a id="waTutong" href="#" target="_blank" class="admin-card border-amber-200 bg-amber-50/30">
                                    <span class="text-2xl mb-1">üë®‚Äçüîß</span>
                                    <p class="text-[8px] font-black uppercase text-slate-400 mb-1 leading-none">P.O Pejabat 2</p>
                                    <p class="text-[11px] font-black text-slate-800 uppercase leading-none">Tutong</p>
                                </a>
                                <a id="waJelai" href="#" target="_blank" class="admin-card">
                                    <span class="text-2xl mb-1">üë®‚Äçüíº</span>
                                    <p class="text-[8px] font-black uppercase text-slate-400 mb-1 leading-none">P.O Pejabat 2</p>
                                    <p class="text-[11px] font-black text-slate-800 uppercase leading-none">Jelai</p>
                                </a>
                                <a id="waEllyna" href="#" target="_blank" class="admin-card">
                                    <span class="text-2xl mb-1">üë©‚Äçüíª</span>
                                    <p class="text-[8px] font-black uppercase text-slate-400 mb-1 leading-none">Pembantu Tadbir</p>
                                    <p class="text-[11px] font-black text-slate-800 uppercase leading-none text-center">Puan Ellyna Haura</p>
                                </a>
                            </div>
                            <button type="button" onclick="location.reload()" class="mt-8 text-[9px] font-black text-slate-400 uppercase underline tracking-[0.2em]">Selesai / Rekod Baru ‚Üª</button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Sidebar Info & Timer -->
            <div class="lg:col-span-5 flex flex-col gap-8">
                <div class="glass-panel rounded-[3rem] p-10 border-l-[15px] border-slate-900 h-full flex flex-col justify-between shadow-2xl">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800 uppercase italic tracking-tighter mb-8 leading-tight">Automasi Inventori SKKM</h2>
                        <div class="bg-blue-50 p-6 rounded-[2rem] border border-blue-100 mb-8">
                            <p id="dbStatus" class="text-[11px] font-bold text-slate-600 leading-relaxed uppercase tracking-tighter">Menghubungkan Database Cloud...</p>
                        </div>
                    </div>
                    
                    <div class="pt-10 border-t border-slate-100">
                        <span class="text-[10px] font-black text-slate-400 uppercase tracking-[0.5em] block mb-2 leading-none">Inovasi Digital Oleh:</span>
                        <span class="text-xl font-black text-slate-900 uppercase italic tracking-tighter block mb-1">Cikgu Dayangku Nurul Akmal</span>
                        <span class="text-xs font-bold text-slate-400 uppercase block mb-8 tracking-widest leading-none">Awang Mustapha</span>
                        
                        <div class="space-y-4">
                            <p class="text-[11px] font-bold text-slate-500 uppercase tracking-widest leading-none">
                                Dibangunkan pada: <span class="text-slate-900 font-black border-b-2 border-amber-400 pb-1">12 Februari 2026</span>
                            </p>
                            <!-- Count Up Timer -->
                            <div class="bg-slate-900 text-white p-7 rounded-[2.5rem] shadow-2xl relative overflow-hidden">
                                <p class="text-[9px] font-black text-slate-500 uppercase tracking-widest mb-3 relative z-10">Masa Beroperasi Sejak Pelancaran:</p>
                                <div id="countup" class="text-xl font-black text-amber-400 tracking-tighter font-mono italic uppercase relative z-10 leading-none">0 Hari 0 Jam 0 Min 0 Saat</div>
                                <div class="absolute -right-5 -bottom-5 text-6xl font-black text-white/5 italic">SKKM</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script>
        // --- KONFIGURASI ---
        const ADMIN_PASS  = 'SKKM2026';
        const scriptURL   = 'https://script.google.com/macros/s/AKfycbwsNH7gREyf6BfDQOaolX5DGpN0yEDpvWU0g1XhskWJSHs44tNn5wlmFiKty-6IE2D_/exec'; 
        const launchDate  = new Date("February 12, 2026 00:00:00").getTime();

        // 1. Timer Beroperasi
        function updateTimer() {
            const now = new Date().getTime();
            const diff = now - launchDate;
            if(diff < 0) { document.getElementById("countup").innerText = "SISTEM DALAM PERSEDIAAN"; return; }
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            document.getElementById("countup").innerText = `${days} HARI ${hours} JAM ${minutes} MIN ${seconds} SAAT`;
        }
        setInterval(updateTimer, 1000);
        updateTimer();

        // 2. Load Staff dari Google Sheet
        async function loadStaff() {
            try {
                const response = await fetch(scriptURL);
                const staffList = await response.json();
                const dropdown = document.getElementById('staffDropdown');
                dropdown.innerHTML = '<option value="" disabled selected>-- PILIH NAMA ANDA --</option>';
                staffList.forEach(name => {
                    const opt = document.createElement('option');
                    opt.value = name; opt.text = name;
                    dropdown.add(opt);
                });
                document.getElementById('dbStatus').innerText = "Database Connected: Live Staff Data Loaded";
                document.getElementById('dbStatus').className = "text-[11px] font-bold text-emerald-600 uppercase tracking-tighter";
            } catch (e) { document.getElementById('dbStatus').innerText = "Database Offline: Sila Reload"; }
        }

        // 3. Role Control Logic
        let currentRole = 'guru';
        function setRole(role) {
            currentRole = role;
            const field = document.getElementById('gerakanField');
            const btnGuru = document.getElementById('btnRoleGuru');
            const btnAdmin = document.getElementById('btnRoleAdmin');
            const adminSheetBtn = document.getElementById('adminSheetBtn');
            const rIcon = document.getElementById('roleIcon');
            const rTitle = document.getElementById('roleTitle');

            if (role === 'guru') {
                field.innerHTML = '<option value="KELUAR" selected>STOK KELUAR (-)</option>';
                field.className = 'w-full p-5 border-2 border-rose-100 rounded-[1.5rem] font-black text-sm text-rose-600 outline-none';
                btnGuru.className = 'px-6 py-2 rounded-xl text-[10px] font-black uppercase bg-amber-500 text-slate-900 shadow-xl transition-all';
                btnAdmin.className = 'px-6 py-2 rounded-xl text-[10px] font-black uppercase text-slate-400 hover:text-white transition-all';
                adminSheetBtn.classList.add('hidden');
                rIcon.className = 'bg-slate-900 text-white p-3 rounded-2xl';
                rTitle.innerText = "Rekod Pengeluaran";
            } else {
                field.innerHTML = '<option value="MASUK">STOK MASUK (+)</option><option value="KELUAR">STOK KELUAR (-)</option>';
                field.className = 'w-full p-5 border-2 border-emerald-100 rounded-[1.5rem] font-black text-sm text-emerald-600 outline-none';
                btnAdmin.className = 'px-6 py-2 rounded-xl text-[10px] font-black uppercase bg-emerald-500 text-white shadow-xl transition-all';
                btnGuru.className = 'px-6 py-2 rounded-xl text-[10px] font-black uppercase text-slate-400 hover:text-white transition-all';
                adminSheetBtn.classList.remove('hidden');
                rIcon.className = 'bg-emerald-600 text-white p-3 rounded-2xl';
                rTitle.innerText = "Kemasukan Admin";
            }
        }

        function promptAdmin() { if (prompt("Sila masukkan Kod Akses Admin:") === ADMIN_PASS) setRole('admin'); else alert("Kod Akses Salah!"); }

        let isManual = false;
        function toggleInv() {
            isManual = !isManual;
            document.getElementById('iSel').classList.toggle('hidden');
            document.getElementById('iInp').classList.toggle('hidden');
            document.getElementById('tBtn').innerText = isManual ? 'Pilihan ‚Ü©' : 'Manual ‚úé';
        }

        // 4. Submission & WhatsApp Center
        document.getElementById('stokForm').addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('submitBtn');
            btn.innerText = 'MEMPROSES REKOD...';
            btn.disabled = true;

            const data = {
                guru: e.target.guru.value,
                punca: e.target.punca.value,
                item: e.target.item.value,
                gerakan: e.target.gerakan.value,
                qty: e.target.qty.value,
                invois: isManual ? document.getElementById('iInp').value : document.getElementById('iSel').value
            };

            fetch(scriptURL, { method: 'POST', mode: 'no-cors', body: JSON.stringify(data) })
            .then(() => {
                btn.innerText = 'REKOD BERJAYA DISIMPAN!';
                btn.className = 'w-full bg-emerald-600 text-white font-black py-6 rounded-[1.5rem] uppercase text-xs shadow-none';
                
                if(data.gerakan === "KELUAR" && currentRole === 'guru') {
                    const msg = `*E-STOK SKKM: MAKLUMAN PENGELUARAN*%0A------------------------------------%0A*Item:* ${data.item}%0A*Bilangan:* ${data.qty} UNIT%0A*Diambil Oleh:* ${data.guru}%0A*Catatan:* ${data.invois}%0A%0A_Mohon maklumbalas jika perlu. Terima kasih._`;
                    
                    document.getElementById('waTutong').href = `https://wa.me/60138416042?text=${msg}`;
                    document.getElementById('waJelai').href = `https://wa.me/60178327839?text=${msg}`;
                    document.getElementById('waEllyna').href = `https://wa.me/60178372362?text=${msg}`;
                    
                    document.getElementById('waCenter').classList.remove('hidden');
                    document.getElementById('waCenter').scrollIntoView({ behavior: 'smooth' });
                } else { setTimeout(() => location.reload(), 2000); }
            });
        });

        loadStaff();
        setRole('guru');
    </script>
</body>
</html>